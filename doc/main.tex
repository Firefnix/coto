\documentclass{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathrsfs}

\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage{tikz-cd}

\newcommand{\RE}{\mathrm{Re}}
\newcommand{\IM}{\mathrm{Im}}
\newcommand{\function}[5]{\begin{array}{l|rcl}
#1: & #2 & \longrightarrow & #3 \\
    & #4 & \longmapsto & #5 \end{array}}

\title{AAQDD -- Abstract additive quantum decision diagrams}
\author{M. Leroy, R. Vilmart}

\begin{document}

\maketitle

\section{Formal definition}

\subsection{Abstract states}

The purpose of quantum decision diagrams is to provide a more efficient way to store and manipulate quantum states of a finite number of qubits. A $n$-qubit state is indeed traditionally represented as an element of $\mathbb{C}^{2^n}$ (with norm 1), which takes exponential space as $n$ grows. Abstract states will be in this part defined similarly, but with complex intervals instead of complex numbers.

The standard definition of real intervals is:
$$\forall a, b \in \mathbb{R}, [a, b]
= \{x \in \mathbb{R} / \min(a, b) \le x \le \max(a, b)\}$$

Those can be generalised to complex intervals, commonly using the cartesian notation.
$$\forall x, y \in \mathbb{C}, [x, y]
= \{a + ib ; a \in [\RE(x), \RE(y)], b \in [\IM(x), \IM(y)]\}$$

Now let $\mathcal{A}_0 = \{[x, y] ; x, y \in \mathbb{C}\}$, we can now define basic operations: sum, product, and join. We note that these definition do not depend on the type of complex interval chosen.
$$\forall \alpha, \beta \in \mathcal{A}_0, \alpha + \beta = \{a + b ; a \in \alpha, b \in \beta\}$$
$$\forall \alpha, \beta \in \mathcal{A}_0, \alpha * \beta = \{a * b ; a \in \alpha, b \in \beta\}$$
$$\forall \alpha, \beta \in \mathcal{A}_0, \alpha \sqcup \beta = \bigcap_{\alpha \subset \gamma~\text{and}~\beta \subset \gamma} \gamma$$

We now have intervals, \textit{abstract elements} of $\mathbb{C}$ represented in $\mathcal{A}_0$. Our abstract elements for a $n$-qubit quantum state would be in $\mathcal{A}_n = {\mathcal{A}_0}^{2^n}$ for all $n \in \mathbb{N}$. Defining a sum in $\mathcal{A}_n$, and an external product $\alpha * A$ for
$\alpha \in \mathcal{A}_0$ and $A \in \mathcal{A}_n$, comes easily. We also define the inclusion relation in $\mathcal{A}_n$ (which is an order relation) $\subset$ using the cartesian product of sets:
$$\forall A = (a_0, ..., a_{2^n-1})^{T},  B = (b_0, ..., b_{2^n-1})^{T} \in \mathcal{A}_n, A \subset B \iff a_0 \times ... \times a_{2^n-1} \subset b_0 \times ... \times b_{2^n-1}$$

\subsection{Abstract state imprecision}

Intuitively, if $A$ and $B$ are in $\mathcal{A}_n$ and $A \subset B$, the abstract state $A$ is more \textit{precise} than $B$. In order to work with this notion, and later on to make it work with diagrams and approximations, we define the \textit{imprecision} $\mathcal{I}$ of an abstract state:
$$\function{\mathcal{I}}
{\bigcup_{n \in \mathbb{N}} \mathcal{A}_n}{\mathbb{R}^+}
{A \in \mathcal{A}_n}{\displaystyle\prod_{i = 0}^{2^n-1} s(A_i)}$$

\noindent using the surface function $s$ on complex intervals defined by
$$s(\alpha) = (\max\{\RE(z) ; z \in \alpha\} - \min\{\RE(z) ; z \in \alpha\}) \times (\max\{\IM(z) ; z \in \alpha\} - \min\{\IM(z) ; z \in \alpha\})$$

\subsection{Decision diagrams}

We inductively define abstract additive quantum decision diagrams, starting from zero-depth decision. The only zero-depth diagram is $\boxed{1}$. Let for every set $E$ be the set of finite subsets of $E$: $\mathscr{P}_f(E) = \{ A \subset E / |A| < \infty \}$. If the set $\mathcal{D}_n$ of diagrams of depth $n$ is defined, $n+1$-depth diagrams can have a finite number of left children in $\mathcal{D}_n$ and a finite number of right children in $\mathcal{D}_n$, each being associated with an abstract amplitude in $\mathcal{A}_0$.

\begin{center}
    % https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZAZgBoAGAXVJADcBDAGwFcYkQAREAX1PU1z5CKAEykAjNTpNW7KAH1gYALTjuPPiAzY8BIgBYJUhizaIQAc3niN-HUKIA2IzROzzV4AFtV63ncE9FHIXaVM5eXJbLQFdYWRxULczEAA6dOjtQPiAViSZFPTUnikYKAt4IlAAMwAnCC8kEJAcCCREsPcQAB1upjQAC3pFFTUQGkZ6ACMYRgAFWIdzRhhqnGi6hqaaVqQxTpTemZxhqInp2YX7IJBarAsB9f8QTcbEZt3EMgP2I5gTxQ+MbPV7bFptRCGH7mXr9IaRcYgSYzeaLG53B5PSjcIA
    \begin{tikzcd}
        &     &         & D \arrow[ld, "\alpha_{n-1}"] \arrow[rd, "\beta_0"'] \arrow[rrrd, "\beta_{m-1}"] \arrow[llld, "\alpha_0"'] &     &     &         \\
    d_0 & ... & d_{n-1} &                                                                                                           & g_1 & ... & g_{m-1}
    \end{tikzcd}
\end{center}

Defining $\mathcal{D}_{n+1} = \mathscr{P}_f(\mathcal{A}_0 \times \mathcal{D}_n) \times \mathscr{P}_f(\mathcal{A}_0 \times \mathcal{D}_n)$ thus comes naturally. Eventually, let $\mathcal{D} = \bigcup_{n \in \mathbb{N}} \mathcal{D}_n$ the set of all AAQDDs.

\subsection{Sub-diagrams}

Sub-diagrams (or nodes) of a diagram $D \in \mathcal{D}_n$ for all $n \in \mathbb{N}$, are defined indictively:
$$\mathcal{N}(\boxed{1}) = \boxed{1}$$
$$\forall D, G \in \mathscr{P}_f(\mathcal{A}_0 \times \mathcal{D}_n), \mathcal{N}(D, G) = \{d ; (\alpha, d) \in D \cup G\} \cup
\bigcup_{(\alpha, d) \in D \cup G} \mathcal{N}(d)$$

We also define $\mathcal{N}_i(D) = \mathcal{N}(D) \cap \mathcal{D}_i$ for all $i \in \mathbb{N}$.

\subsection{Diagram evaluation}

Now that we defined our decision diagrams, we can evaluate them to get abstract elements. We inductively define our evaluation function for $n$ quibits $\mathcal{E}_n : \mathcal{D}_n \rightarrow \mathcal{A}_n$:

$$\mathcal{E}_0(\boxed{1}) = \{1\}$$

$$\forall D, G \in \mathscr{P}_f(\mathcal{A}_0 \times \mathcal{D}_n), \mathcal{E}_{n+1}(D, G) =
\begin{pmatrix}
    \displaystyle\sum_{(\alpha, g) \in G} \alpha * \mathcal{E}_n(g) \\
    \displaystyle\sum_{(\beta, d) \in D} \beta * \mathcal{E}_n(d) \\
\end{pmatrix}
\quad\text{with}
$$

Since there is no risk of ambiguity, defining $\mathcal{E} : \bigcup \mathcal{D}_n \rightarrow \bigcup \mathcal{A}_n$ is not problematic. With this last function, we can now evaluate all our AAQDDs and define a partial order $\le$ on $\mathcal{D}$, with:
$$\forall A, B \in \mathcal{D}, A \le B \iff \mathcal{E}(A) \subset \mathcal{E}(B)$$

Additionally, we extend the definition of the imprecision function $\mathcal{I}$ to diagrams: $\forall D \in \mathcal{D}, \mathcal{I}(D) = \mathcal{I}(\mathcal{E}(D))$. Note that $\forall A, B \in \mathcal{D}_n, A \le B$ implies that $\mathcal{I}(A) \le \mathcal{I}(B)$ but that the reciprocal is not generally true.

\section{Reduction algorithm}

We note that multiple QDDs can be evaluated to the same abstract state. This part will aim to provide an algorithm to decrease the "size" of diagrams while not breaking their evaluation by $\mathcal{E}$. The size of a AAQDD is the number of intervals (counting them with their multiplicity). We would want, from a diagram $D$, to get a diagram $D'$ such that $\text{size}(D) > \text{size}(D')$ and $D \le D'$ (the reduction is smaller in size and might be less precise that the original diagram). More generally, function $g : \mathcal{D}_n \rightarrow \mathcal{D}_n$ is an \textit{global approximation} if
$$\forall D \in \mathcal{D}_n, D \le g(D)$$

Similarly, a function $f : \mathcal{D}_n \times \mathcal{D}_n \rightarrow \mathcal{D}_n$ is a \textit{merge approximation at height $n$} if
$$\begin{cases}
    \forall A \not= B \in \mathcal{D}_n, A \le f(A, B)~\text{and}~B \le f(A, B) \\
    \forall A \in \mathcal{D}_n, f(A, A) = A
\end{cases}
$$

We developed a reduction formula to force the merging of two nodes. This is permitted both thanks to abstract interpretation (to merge without amplitudes being colinear) and the additive nature of diagrams. The cost $\mathcal{C}_f : \mathcal{D}_n \rightarrow \mathbb{R}^+$ of applying a global approximation $f$ to a diagram $D \in \mathcal{D}_n$ is defined by:

$$\mathcal{C}_f(D) = \mathcal{I}(f(D)) - \mathcal{I}(D)$$

\subsection{Merging theorem}

Let $n \in \mathbb{N}^*$, $N \ge n$, and $f$ be a merge approximation. Moreover let $w : \mathcal{D}_N \rightarrow \mathcal{D}_n \times \mathcal{D}_n$ be a choice function at height $n$ in $\mathcal{D}_N$, meaning that $\forall D, w(D) \in \mathcal{N}_n(D) \times \mathcal{N}_n(D)$. Now we define:

$$\function{f | w}{\mathcal{D}_N}{\mathcal{D}_N}{D}{r_N(B, C, r_N(A, C, D))\quad \text{with}~C = f(w(D))}$$

With $\forall i > 0, r_i : \mathcal{D}_n \times \mathcal{D}_n \times \mathcal{D}_i \rightarrow \mathcal{D}_i$ the replacement function defined by:
$$\begin{cases}
\forall n > i, \forall A, B \in \mathcal{D}_n, \forall D \in \mathcal{D}_i, r_i(A, B, D) = D \\
\forall A, B, D \in \mathcal{D}_n, r_n(A, B, D) = \begin{cases}
B \quad \text{if}~D = A \\
D \quad \text{otherwise}
\end{cases} \\
\forall 1 \le n < i, \forall A, B \in \mathcal{D}_n, \forall \{(\alpha_j, g_j)\}, \{(\beta_k, d_k)\} \in \mathcal{D}_{i-1},\\
\hfill r_i(A, B, (G, D)) = (\{(\alpha_j, r_{i-1}(g_j))\}, \{(\beta_k, r_{i-1}(d_k))\})
\end{cases}
$$

\noindent\underline{\textbf{Merging theorem:}} Let $f$ be a merge approximation at height $n$ and $w$ be a choice function at height $n$ in $\mathcal{D}_N$. $f|w$ is a global approximation in $\mathcal{D}_N$.

\noindent\underline{Proof:} Let $D \in \mathcal{D}_N$, $(A, B) = w(D)$ and $C = f(w(D))$. By ascending induction (in height), it comes that $\forall U, V \in \mathcal{D}_n, U \le V \Rightarrow r_N(U, V, D) \le D$. Meanwhile, $f$ is a merge approximation so $A \le C$, thus $r_N(A, C, D) \le D$.

Proving that $r_N(A, C, D) \le D$ is mostly enough to prove the theorem, because once it is proven we only have let $D' = r_N(A, C, D)$ and use this result on $B$ and $D'$ to conclude that $r_N(B, C, D') \le D'$. The only problem is that we would need $C' = f(w(D'))$ instead of $C$ to reuse the exact same result demonstrated earlier.
\hfill{} $\boxed{}$


\subsection{One-side case}

To begin, let's consider the simple case where all diagrams only have left children (this case would be useless in practice because it would result in only one interval and zeros). Let's say we want to merge the two diagrams:
\begin{gather*}
A = (\{(\alpha_0, a_0), ..., (\alpha_{l-1}, a_{l-1}), (\beta(A)_0, b_0), ..., (\beta(A)_{n-1}, b_{n-1})\}, \emptyset)\quad \text{and} \\
C = (\{ (\beta(C)_0, b_0), ..., (\beta(C)_{n-1}, b_{n-1}), (\gamma_0, c_0), ..., (\gamma_m, c_{m-1}) \}, \emptyset)
\end{gather*}
\noindent with $\{a_0, ..., a_{l-1}\} \cap \{c_0, ..., c_{m-1}\} = \emptyset$. A graphic representation of our merging formula would be:

\vspace{1.7cm}
\leftskip=200pt
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZAJgBoAGAXVJADcBDAGwFcYkQQBfU9TXfQigAsFanSat2XHiAzY8BIgHZRNBizaIO3XvIFEAnKvEapO2XwWCSpAIxj1krQEFpu-ouF2HEzSADCbhZ6nsgArN5qvmYych7WKvZRplpBcVZEAByRJk4gADr5ODAAHjjAALYwAE4A5jCcABTOpAAE-gCUaZb6KOSkxD4pIPQA+uTdIda2A0N5Y8CMALS2nJPxRGSDyXkARuPrGSgAzLM7fvvAYCtr5um9yCLbuX4Axgd3PaERz45vo5UbocHgA2M4vdhjCafKbKcF-SEA5arYGhbK-aJafbQ2JfaxGDHDS7XFEwjYoWz9Ql5d449xHZC2GbU-6A0liGBQeoIFCgABm1QgFSQ-RAOAgSBEEK0zBANEY9F2MEYAAU8exGDA+TgggKhUgZmKJYgItK6HKQAqlar1VpNdrdYLhYgyEakNkzbL5YrlWrYXatTrzHrnac3YgPQitLQLVbfbaQNUsLUABZBmQhyU0cUG0VRsDMRiMb3Wv3ky2Bx36xBSnOIJnnJAFosl+P+isO4NOrPh2yuqMFfJKnD0ZodUYAK1jPpt7ft6f53Zr2eNRjNhSYaBTYyw09LCaTqYXIEzJpXBsN+cLxctM7LRw7x9PprrfcbWkKw9HACFx1PW7O5bzlWzovsathhleLa3vuc6Vl21ZgQaUoDoUtT0BUFRjAA1nubZAfBGZLmC4YqGajR8hUXQAfevSPrGWBgH4UAQMwuyaiB7rnvWJFQTecaAQ+wEIc6HqvmRqH5LAjAjpOeGCXRwlEdWYngZGmLNvxd4Jkpi4qdxtimpJm7bqMu40QeyZppxEYGWufEWXBnbKaJ3HEHmmKDuhmE4fJtGePRIlIGur4eSkmmOQRDo0CmMD0FA7CQExDHJVoUD0HAsUJUF9aGq+-YadekVCZWMVxQlWhJWw8qMcxGVZTZEEGShhXQQJ-mCPRZXxYlBDVZatXsOlmWco1SE8e+EUwfhJXRSAsU9ZVfUpXVI3ZS5Bpka+6nhUV00KQFwHdRV4DLTVqUgMNDU5bYIXGu5k17e1OmlfN5W9cl52rddlCcEAA
\begin{tikzcd}[overlay]
                               &         & {} \arrow[d, "u"]                                                        &         & {} \arrow[d, "v"]                                                       &                                   &                                & {} \arrow[rd, "u"] &                                                                                                                                & {} \arrow[ld, "v"'] &                                &         \\
                               &         & A \arrow[ld] \arrow[d] \arrow[rd, "\beta(A)_j"] \arrow[lld, "\alpha_i"'] &         & C \arrow[lld] \arrow[ld, "\beta(B)_j"] \arrow[d] \arrow[rd, "\gamma_k"] & {} \arrow[rr, "(\text{fm})", Rightarrow] &                                & {}                 & {\text{fm}(A, C)} \arrow[ld] \arrow[d, "\delta_j"] \arrow[rd] \arrow[lld, "\alpha_i"'] \arrow[rrd] \arrow[rrrd, "\gamma_k"] &                     &                                &         \\
a_0 \arrow[r, no head, dashed] & a_{l-1} & b_0 \arrow[r, no head, dashed]                                           & b_{n-1} & c_0 \arrow[r, no head, dashed]                                          & c_{m-1}                           & a_0 \arrow[r, no head, dashed] & a_{l-1}            & b_0 \arrow[r, no head, dashed]                                                                                                 & b_{n-1}             & c_0 \arrow[r, no head, dashed] & c_{m-1}
\end{tikzcd}

\vspace{1.7cm}
\leftskip=0pt

\noindent with $\delta_j = \beta(A)_j \sqcup \beta(B)_j$. More formally, the merging formula would be:
$$\text{fm}(A, C) = (\{(\alpha_0, a_0), ..., (\alpha_{l-1}, a_{l-1}), (\delta_0, b_0), ..., (\delta_{n-1}, b_{n-1}), (\gamma_0, c_0), ..., (\gamma_m, c_{m-1})\}, \emptyset)$$

\subsection{Fully connected case}


Let's consider another case, where our two nodes $A$ and $B$ have both a common left-descendance and a common right-descendance. We will see later that the general case can always be reduced to this case. The abstract amplitude on the link between two nodes is $\text{ampl}(u, v)$, for example $\text{ampl}(A, l_0)$ or $\text{ampl}(B, l_0)$. Additionally, let $X = {l_0, ..., l_{n-1}, r_0, ..., r_{m-1}}$.

\vspace{1.7cm}
\leftskip=200pt
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZAJgBoAGAXVJADcBDAGwFcYkQBBEAX1PU1z5CKACwVqdJq3YAhHnxAZseAkXKliEhizaIQjAPrl5-ZUKJlNNbdL2HgYALQBGbicUCVw5GKuSd7ABORu5KgqooAGwaWlK6IMHAALYubrym4d4A7DHWceyGxukeZhHIAJy5-rb6Bg6poZ7mKM7OVTbxwUUKYV5EzgDM7fl6iSmujaXezupUeQF6AMIABAC8ywA6GzgwAB44wABmSdwAFBykyzIAlJOZRNHOsQsgd30oABykT-M1PBIwKAAc3gRFAh0CECSSHUIBwECQZH0WDA8Sg9DgAAtAe4IVCYTR4UghsjUex0ViccU8dDEEiiYgSYwUWiIDgdlAQDRsfROXpIGTqZDaW04Qi6TRmWS9BTsZyhfjEKKGUyWeSMXLccKCWKkCIFSLCeL9QoaTqGQBWA16o1IC3cmC89gCtiStUytkcrWK5Xiq2m7WIaK6xA5Ums9k4h1O-kENjWxBfEOVEA8vngONc8Pkz1UgM+2EMsNStEavPgwMzW2JhNV5O131IZxIks55gAI0YrtTjr5YGYjEYhPoWEYzszv3iWx2+2Ap2O1zS+ZFhfFwdbMrL8so3CAA
\begin{tikzcd}[overlay]
                                &  & A \arrow[lldd, dashed] \arrow[dd, dashed] \arrow[rrdd] \arrow[rrrrdd] &  & B \arrow[lllldd, dashed] \arrow[lldd, dashed] \arrow[dd] \arrow[rrdd] &  &                                          &                                 &    &         & {C = \text{fm}(A, B)} \arrow[ldd, dashed] \arrow[rdd] \arrow[rrrdd] \arrow[llldd, dashed] &                                 &  &         \\
                                &  &                                                                       &  &                                                                       &  & {} \arrow[rr, "\text{(fm)}", Rightarrow] &                                 & {} &         &                                                                                           &                                 &  &         \\
l_0 \arrow[rr, no head, dotted] &  & l_{n-1}                                                               &  & r_0 \arrow[rr, no head, dotted]                                       &  & r_{m-1}                                  & l_0 \arrow[rr, no head, dotted] &    & l_{n-1} &                                                                                           & r_0 \arrow[rr, no head, dotted] &  & r_{m-1}
\end{tikzcd}

\vspace{1.7cm}
\leftskip=0pt

Where the new abstract amplitudes are defined by the following formula:

$$\forall x \in {l_0, ..., l_{n-1}, r_0, ..., r_{m-1}}, \text{ampl}(C, x) = \text{ampl}(A, x) \sqcup \text{ampl}(B, x)$$

\noindent\underline{\textbf{Proof:}}

\end{document}
